<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نظام مواعيد المركز</title>
  <style>
    /* استيراد خط "Cairo" من Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

    :root {
      /* ألوان الهوية البصرية - باستيل */
      --color-navy: #1F2F3D;
      --color-mint: #87C8BC;
      --color-cream: #FFF9E6;
      --color-peach: #F9D2A3;
      --color-beige: #F5E6C8;
      --color-bg:   #CDEDE6;
    }
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      padding: 0;
      direction: rtl;
      background-color: var(--color-bg);
    }
    header {
      background-color: var(--color-navy);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px; /* شريط علوي أكبر */
    }
    header img {
      height: 70px; /* تكبير الشعار */
    }
    header h1 {
      margin: 0;
      font-size: 28px; /* تعديل جملة العنوان */
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      background-color: var(--color-cream);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    form {
      margin-bottom: 20px;
      background-color: var(--color-beige);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    form div {
      margin-bottom: 10px;
    }
    label {
      display: inline-block;
      width: 130px;
      font-weight: bold;
    }
    input, select {
      padding: 5px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* تنسيق مربعات الاختيار للأقسام */
    .dept-checkbox {
      margin-right: 10px;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
      background-color: var(--color-mint);
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 14px;
    }
    button:hover {
      background-color: #6ab3a7;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls input {
      margin: 0 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: var(--color-peach);
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .action-btn {
      background-color: var(--color-peach);
      color: #333;
      font-size: 12px;
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- رأس الصفحة مع شعار -->
  <header>
    <img src="logo.png" alt="شعار المركز">
    <h1>نظام مواعيد المركز</h1>
  </header>

  <!-- نموذج إدخال بيانات الموعد -->
  <form id="appointmentForm">
    <div>
      <label for="childName">اسم الطفل:</label>
      <input type="text" id="childName" required>
    </div>
    <div>
      <label for="day">اليوم:</label>
      <select id="day" required>
        <option value="السبت">السبت</option>
        <option value="الأحد">الأحد</option>
        <option value="الاثنين">الاثنين</option>
        <option value="الثلاثاء">الثلاثاء</option>
        <option value="الأربعاء">الأربعاء</option>
        <option value="الخميس">الخميس</option>
      </select>
    </div>
    <div>
      <label for="timeSlot">الوقت:</label>
      <select id="timeSlot" required>
        <option value="1:00 - 1:40">1:00 - 1:40</option>
        <option value="1:40 - 2:20">1:40 - 2:20</option>
        <option value="2:20 - 3:00">2:20 - 3:00</option>
        <option disabled>-- بريك 3:00 - 3:20 --</option>
        <option value="3:20 - 4:00">3:20 - 4:00</option>
        <option value="4:00 - 4:40">4:00 - 4:40</option>
        <option value="4:40 - 5:20">4:40 - 5:20</option>
        <option value="5:20 - 6:00">5:20 - 6:00</option>
        <option value="6:00 - 6:40">6:00 - 6:40</option>
        <option value="6:40 - 7:20">6:40 - 7:20</option>
        <option value="7:20 - 8:00">7:20 - 8:00</option>
        <option value="8:00 - 8:40">8:00 - 8:40</option>
        <option value="8:40 - 9:20">8:40 - 9:20</option>
      </select>
    </div>
    <div>
      <label>الأقسام المطلوبة:</label>
      <!-- مربعات اختيار للأقسام -->
      <input type="checkbox" class="dept-checkbox" id="dept1" value="تعديل سلوك">
      <label for="dept1">تعديل سلوك</label>
      <input type="checkbox" class="dept-checkbox" id="dept2" value="تخاطب">
      <label for="dept2">تخاطب</label>
      <input type="checkbox" class="dept-checkbox" id="dept3" value="تنمية مهارات">
      <label for="dept3">تنمية مهارات</label>
      <input type="checkbox" class="dept-checkbox" id="dept4" value="جلسة نفسية">
      <label for="dept4">جلسة نفسية</label>
      <input type="checkbox" class="dept-checkbox" id="dept5" value="اختبار ذكاء">
      <label for="dept5">اختبار ذكاء</label>
    </div>
    <div>
      <label for="appointmentType">نوع الموعد:</label>
      <select id="appointmentType" required>
        <option value="عادي">عادي</option>
        <option value="تعويض">تعويض</option>
      </select>
    </div>
    <div>
      <label for="specialist">اسم الأخصائي:</label>
      <!-- هنا يُمكنك تركه فارغاً لأن التوزيع سيكون تلقائياً -->
      <input type="text" id="specialist" placeholder="تُعبأ تلقائياً" readonly>
    </div>
    <div>
      <label for="subscription">نوع الاشتراك:</label>
      <select id="subscription" required>
        <option value="24 جلسة">24 جلسة</option>
        <option value="36 جلسة">36 جلسة</option>
        <option value="ساعة اختبار">ساعة اختبار</option>
        <option value="ساعتين اختبار">ساعتين اختبار</option>
      </select>
    </div>
    <div>
      <label for="notes">ملاحظات:</label>
      <input type="text" id="notes">
    </div>
    <div>
      <button type="submit">إضافة الموعد</button>
      <button type="button" onclick="clearForm()">مسح الحقول</button>
    </div>
  </form>

  <!-- أدوات التصفية -->
  <div class="controls">
    <label for="filterSpec">تصفية حسب الأخصائي:</label>
    <input type="text" id="filterSpec">
    <button onclick="filterAppointments()">تصفية</button>
    <button onclick="showAllAppointments()">عرض الجميع</button>
  </div>

  <!-- أدوات الحفظ والاستعادة -->
  <div class="controls">
    <button class="small-btn" onclick="saveAppointments()">حفظ المواعيد</button>
    <button class="small-btn" onclick="loadAppointments()">استعادة المواعيد</button>
  </div>

  <!-- جدول عرض المواعيد -->
  <table>
    <thead>
      <tr>
        <th>اسم الطفل</th>
        <th>اليوم</th>
        <th>الوقت</th>
        <th>القسم</th>
        <th>نوع الموعد</th>
        <th>اسم الأخصائي</th>
        <th>نوع الاشتراك</th>
        <th>ملاحظات</th>
        <th>الإجراء</th>
      </tr>
    </thead>
    <tbody id="appointmentsBody">
      <!-- سيتم إضافة المواعيد هنا -->
    </tbody>
  </table>
</div>

<script>
/* ======================= إعدادات النظام ======================= */
/* قائمة المختصين المُتاحة لكل قسم */
const specialistList = {
  "تعديل سلوك": ["أحمد", "محمد"],
  "تخاطب": ["سامي", "علي"],
  "تنمية مهارات": ["خالد", "فاطمة"],
  "جلسة نفسية": ["نور", "مريم"],
  "اختبار ذكاء": ["عمرو", "سيف"]
};

/* لتوزيع التعيين: سنختار أول متخصص متاح لكل قسم */
function assignSpecialist(dept, day, timeSlot) {
  // للحصول على التعيين البسيط: نختار أول اسم من القائمة
  const list = specialistList[dept] || [];
  // يمكننا إضافة شرط للتأكد من عدم تعارض التعيين في نفس اليوم والفترة إذا احتجت لذلك
  return list.length ? list[0] : "";
}

/* ======================= نظام المواعيد ======================= */
let appointments = [];
const MAX_PER_SLOT = 5; // لا يتجاوز 5 أطفال في نفس (اليوم + الوقت)

/* عند تقديم النموذج: إضافة موعد جديد */
document.getElementById('appointmentForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const childName = document.getElementById('childName').value.trim();
  const day = document.getElementById('day').value;
  const timeSlot = document.getElementById('timeSlot').value;
  const subscription = document.getElementById('subscription').value;
  const appointmentType = document.getElementById('appointmentType').value;
  const notes = document.getElementById('notes').value.trim();

  // جمع الأقسام المطلوبة من مربعات الاختيار
  const deptCheckboxes = document.querySelectorAll('.dept-checkbox');
  let requiredDepts = [];
  deptCheckboxes.forEach(checkbox => {
    if(checkbox.checked) requiredDepts.push(checkbox.value);
  });
  if(requiredDepts.length === 0){
    alert("يرجى اختيار قسم واحد على الأقل.");
    return;
  }
  
  // تحقق من عدد الأطفال في نفس (اليوم + الوقت)
  if(isSlotFull(day, timeSlot)) {
    alert("عفواً، هذا الموعد (" + day + " - " + timeSlot + ") ممتلئ بخمسة أطفال.");
    return;
  }
  
  // لكل قسم مطلوب، يتم إنشاء موعد منفصل مع تعيين أخصائي تلقائي
  requiredDepts.forEach(dept => {
    const assignedSpecialist = assignSpecialist(dept, day, timeSlot);
    const appointment = {
      childName,
      day,
      timeSlot,
      department: dept,
      appointmentType, // عادي أو تعويض
      specialist: assignedSpecialist,
      subscription,
      notes
    };
    appointments.push(appointment);
  });
  
  // تحديث حقل "اسم الأخصائي" في النموذج ليكون فارغ (أو يمكنك عرضه كنتيجة للتعيين)
  document.getElementById('specialist').value = "";
  
  displayAppointments();
  this.reset();
  // إلغاء تحديد مربعات الاختيار
  document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = false);
});

/* ======================= عرض المواعيد ======================= */
function displayAppointments(filteredList = null) {
  const list = filteredList || appointments;
  const tbody = document.getElementById('appointmentsBody');
  tbody.innerHTML = "";
  list.forEach((appt, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${appt.childName}</td>
      <td>${appt.day}</td>
      <td>${appt.timeSlot}</td>
      <td>${appt.department}</td>
      <td>${appt.appointmentType}</td>
      <td>${appt.specialist}</td>
      <td>${appt.subscription}</td>
      <td>${appt.notes}</td>
      <td><button class="action-btn" onclick="markAbsent(${index})">تعويض/كشف</button></td>
    `;
    tbody.appendChild(tr);
  });
}

/* ======================= التحقق من امتلاء الموعد ======================= */
function isSlotFull(day, timeSlot) {
  let count = 0;
  for (let appt of appointments) {
    if(appt.day === day && appt.timeSlot === timeSlot) {
      count++;
    }
  }
  return (count >= MAX_PER_SLOT);
}

/* ======================= تصفية المواعيد حسب الأخصائي ======================= */
function filterAppointments() {
  const filterSpec = document.getElementById('filterSpec').value.trim().toLowerCase();
  const filtered = appointments.filter(appt => 
    appt.specialist.toLowerCase() === filterSpec
  );
  displayAppointments(filtered);
}

/* عرض جميع المواعيد */
function showAllAppointments() {
  displayAppointments();
}

/* ======================= مسح الحقول في النموذج ======================= */
function clearForm() {
  document.getElementById('appointmentForm').reset();
  document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = false);
}

/* ======================= حفظ واستعادة المواعيد ======================= */
function saveAppointments() {
  localStorage.setItem('appointments', JSON.stringify(appointments));
  alert("تم حفظ المواعيد في المتصفح.");
}

function loadAppointments() {
  const stored = localStorage.getItem('appointments');
  if(stored) {
    appointments = JSON.parse(stored);
    displayAppointments();
    alert("تم استعادة المواعيد.");
  } else {
    alert("لا توجد مواعيد محفوظة.");
  }
}

/* ======================= إجراء تعويض/كشف عند غياب الطفل ======================= */
/*
 عند الضغط على زر "تعويض/كشف" في صف موعد، يمكننا:
 - تغيير نوع الموعد إلى "تعويض"
 - يُمكنك تعديل بيانات الموعد أو فتح نافذة (modal) لتسجيل موعد بديل 
 (في هذا المثال، سنغير نوع الموعد إلى "تعويض" فقط)
*/
function markAbsent(index) {
  const confirmMark = confirm("هل تريد تسجيل تعويض لهذا الموعد/كشف؟");
  if(confirmMark) {
    appointments[index].appointmentType = "تعويض";
    displayAppointments();
  }
}
</script>
</body>
</html>
